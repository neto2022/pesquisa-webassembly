<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preload" as="fetch" href="./fatorial.wasm" crossorigin />
    <title>Cálculo de Fatorial</title>
  </head>
  <body>
    <h1>Cálculo de Fatorial</h1>
    <div id="wasm">
      <p id="pwasm+js"></p>
    </div>
    <div id="js">
      <p id="pjs">
        <script>
          let input = 100000;
          let inicio, fim;
          let memoriaAntes, memoriaDepois;

          function fatorialJS(n) {
            for (let fat = 1; n > 1; n = n - 1) {
              fat = fat * n;
            }
          }

          inicio = performance.now();
          memoriaAntes = performance.memory;

          fatorialJS(input);

          fim = performance.now();

          let tempoDeExecucao = fim - inicio;

          memoriaDepois = performance.memory;

          let resultado = document.getElementById("pjs");

          resultado.innerHTML = `Tempo de execução: ${tempoDeExecucao} MS JS <br>
Uso de memória: ${
            (memoriaDepois.usedJSHeapSize - memoriaAntes.usedJSHeapSize) /
            1048576
          } MB JS`;
        </script>
      </p>
    </div>
    <div id="wasm-js">
      <p id="pwasm-js">
        <script>
          let inicioWasm, fimWasm, tempoDeExecucaoWasm;
          let memoriaAntesWasm, memoriaDepoisWasm;

          inicioWasm = performance.now();
          async function web(params) {
            let importObject = {};
            let resultObject = await WebAssembly.instantiateStreaming(
              fetch("fatorial.wasm"),
              importObject
            );

           let log = resultObject.instance.exports.fatorial(input);
           console.log(`log`, log);
          }
          inicioWasm = performance.now();

          memoriaAntesWasm = performance.memory.usedJSHeapSize;

          web();

          fimWasm = performance.now();

          memoriaDepoisWasm = performance.memory.usedJSHeapSize;

          tempoDeExecucaoWasm = fimWasm - inicioWasm;

          let resultadoWasm = document.getElementById("pwasm-js");

          resultado.innerHTML = `Tempo de execução: ${tempoDeExecucaoWasm} MS JS+WASM <br>
              Uso de memória: ${
                (memoriaDepoisWasm - memoriaAntesWasm) / 1048576
              } MB JS+WASM`;
        </script>
      </p>
    </div>
    <!-- <script type="module" src="wasm.js"></script> -->
    <!-- <script type="module" src="fatwasm.js"></script> -->
    <!-- <script type="module" src="fat.js"></script> -->
  </body>
</html>
